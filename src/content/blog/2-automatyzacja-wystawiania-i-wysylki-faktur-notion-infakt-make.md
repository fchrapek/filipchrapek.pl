---
title: Automatyczne wystawianie i wysyÅ‚ka faktur - Notion + Infakt + Make
author: Filip Chrapek
pubDatetime: 2023-09-19
postSlug: automatyzacja-wystawiania-i-wysylki-faktur-notion-infakt-make
featured: true
draft: false
tags:
  - produktywnoÅ›Ä‡
  - automatyzacja
description: "Opis"
---

I oto nastaÅ‚ ten czas... WÅ‚aÅ›nie dzwon wybiÅ‚ po raz trzydziesty. NieduÅ¼e stado krukÃ³w, z nieznoÅ›nym skrzekiem wzbiÅ‚o siÄ™ w powietrze, kierujÄ…c siÄ™ w stronÄ™ ledwo juÅ¼ widocznego zza horyzontu sÅ‚oÅ„ca. Okoliczni mieszkaÅ„cy pospiesznie chowajÄ… siÄ™ do swoich domostw, skrupulatnie ryglujÄ…c drzwi i okna. W powietrzu czuÄ‡ nieprzyjemny zapach potu...

StaÅ‚o siÄ™, nadszedÅ‚ koniec miesiÄ…ca.

Pora przywdziaÄ‡ czarnÄ… togÄ™, zarzuciÄ‡ ogromny kaptur, zapaliÄ‡ 2 ceremonialne Å›wiecie i rozpoczÄ…Ä‡ przeraÅ¼ajÄ…cy rytuaÅ‚ buchalterii.

---

Ach biurokracja, ach faktury! Ulubiony temat kaÅ¼dego freelancera, od ktÃ³rego na samÄ… myÅ›l, usta i rÄ™ce same skÅ‚adajÄ… siÄ™ do ekstatycznego 'WOOHOO'! ğŸ‰

<figure>
  <img
	src="https://media4.giphy.com/media/L0O3TQpp0WnSXmxV8p/giphy.gif?cid=ecf05e471mnnberudt4lf9q34eb7halpnsvffo6gsbqjnkga&ep=v1_gifs_search&rid=giphy.gif&ct=g"
	alt="Ross siÄ™ cieszy, bo bÄ™dzie wystawiaÄ‡ faktury"
	width="500px"
	height="auto"
>

  <figcaption>
	Ty, kiedy wiesz, Å¼e dzisiaj wieczorem musisz wystawiÄ‡ 17 faktur i wysÅ‚aÄ‡ je wszystkie, Å‚adnie do klientÃ³w.
  </figcaption>
</figure>

Tak naprawdÄ™, to nie. Koniec miesiÄ…ca ssie.

## Table of contents

## Problem

ByÄ‡ moÅ¼e tak jak i ja, miesiÄ…c w miesiÄ…c wystawiasz rÄ™cznie takie same lub bardzo podobne faktury. Powiedzmy, Å¼e dla klientÃ³w, z ktÃ³rymi wiÄ…Å¼e CiÄ™ dÅ‚uÅ¼sza wspÃ³Å‚praca. I byÄ‡ moÅ¼e, podobnie jak ja, myÅ›lisz sobie "Na bank jest jakiÅ› lepszy, sprytniejszy sposÃ³b, Å¼eby to ogarnÄ…Ä‡". I mimo tego, Å¼e ta myÅ›l jest caÅ‚kiem realna, to momentalnie dominowana jest przez drugÄ… myÅ›l typu: "No dobra, przecieÅ¼ to tylko chwila, wymyÅ›lenie rozwiÄ…zania zajmie mi 5 razy tyle". I tak co miesiÄ…c, w koÅ‚o Macieju.

I tu, caÅ‚y na biaÅ‚o (a raczej fioletowo), pojawia siÄ™ <a href="https://www.make.com/en/register?pc=filipchrapek" target="_blank">Make</a>.

## RozwiÄ…zanie

Make to cudowny wynalazek. WciÄ…Å¼ odkrywam peÅ‚ne moÅ¼liwoÅ›ci tego narzÄ™dzia, natomiast juÅ¼ teraz z sukcesem wykorzystujÄ™ tÄ™ platformÄ™ do kilku regularnych czynnoÅ›ci, ktÃ³re zaliczam do kategorii _nie chcem, ale muszem_.\
JednÄ… z takich czynnoÅ›ci jest niewÄ…tpliwie wystawianie i wysyÅ‚anie faktur. I to wÅ‚aÅ›nie tego byka sprÃ³bujemy zÅ‚apaÄ‡ za rogi.

> W przykÅ‚adzie korzystam z Notion, jako dostawcy danych oraz z Infaktu, ktÃ³ry odpowiedzialny jest za obsÅ‚ugÄ™ faktur. Natomiast skupiaÄ‡ bÄ™dÄ™ siÄ™ gÅ‚Ã³wnie na dopiÄ™ciu caÅ‚oÅ›ci w Make, a nie na opisie dziaÅ‚ania wspomnianych platform. W artykule sÄ…/bÄ™dÄ… podlinkowane odpowiednie miejsca, wiÄ™c jak chcesz, to moÅ¼esz sprawdziÄ‡ szczegÃ³Å‚y na dany temat.

## Tworzenie scenariusza

MiÄ™sem Make sÄ… _Scenarios_, czyli sekwencje nastÄ™pujÄ…cy po sobie (a czasem i rÃ³wnolegle) zdarzeÅ„.

![PrzykÅ‚adowy scenariusz w Make.com](/assets/images/2-automatyzacja-wystawiania-i-wysylki-faktur-notion-infakt-make/make-scenario.png)

> Szybka przypominajka, Å¼e w tym tutorialu nie opisujÄ™ dziaÅ‚ania platformy szerzej. Skupiam siÄ™ konkretnie na scenariuszu. O samej platformie poczytasz wiÄ™cej [tutaj](#).

Zatem do dzieÅ‚a! ğŸ™Œ

### Notion

Triggerem, czyli zdarzeniem wywoÅ‚ujÄ…cym caÅ‚Ä… sekwencjÄ™ bÄ™dzie czynnoÅ›Ä‡ wykonana w Notion. Konkretnie mÃ³wiÄ…c, bÄ™dzie to po prostu klikniÄ™cie checkboxa (a raczej dwÃ³ch).

Klikamy w pustÄ… jeszcze planszÄ™ scenariusz prawym przyciskiem myszy, wybieramy **_Add module_** i odnajdujemy Notion (pomoÅ¼e nam w tym charakterystyczny logotyp).\
NastÄ™pnie, juÅ¼ w obrÄ™bie moduÅ‚u Notion, odnajdujemy **_Search Objects_**. WewnÄ…trz tego moduÅ‚u musimy wskazaÄ‡, ktÃ³ry element ma _zostaÄ‡ odnaleziony_.

#### Å¹rÃ³dÅ‚o danych

> Na tym etapie wspomnÄ™ krÃ³tko o tym, jakÄ… formÄ™ majÄ… dane dostarczane z Notion ([tutaj](#) opisujÄ™ temat nieco bardziej szczegÃ³Å‚owo). Finalna struktura Notion zaleÅ¼y juÅ¼ od Ciebie. WaÅ¼ne, Å¼eby znalazÅ‚y siÄ™ tam pola (wraz z danymi), ktÃ³re chcesz przekazaÄ‡ do Make. U mnie wyglÄ…da to tak:

![Struktura to-do listy w Notion](/assets/images/2-automatyzacja-wystawiania-i-wysylki-faktur-notion-infakt-make/notion-tasks-structure.png)

Mam konkretne zadanie, a w nim informacje ktÃ³re przekazujÄ™ do zewnÄ™trznych platform. _Task_, _Price_ (taki format wymagany jest przez Infakt) i _Related Company_ (zerknij na uwagÄ™ poniÅ¼ej) potrzebne mi bÄ™dÄ… do obsÅ‚ugi faktur w Infakcie, z kolei Make pobiera informacje z pÃ³l _Run scripts_ oraz _Autogenerated invoice via Make_ (nazwy mogÄ… byÄ‡ dowolne).

**WaÅ¼na uwaga**

_Related Company_ to pole typu _Relation_ i potrzebne jest do poprawnego wystawienia faktury. NiespodziankÄ… byÅ‚o dla mnie, Å¼e przygotowujÄ…c scenariusz, pole to udostÄ™pnia tylko _ID_ firmy. Potrzebna jest natomiast peÅ‚na nazwa i w obecnym momencie nie wiem, w jaki sposÃ³b moÅ¼emy jÄ… wyciÄ…gnÄ…Ä‡ w Make po _ID_.
Workaround jaki zastosowaÅ‚em, to dodanie dodatkowego pola _Rollup_ (w Notion jest ukryte, Å¼eby nie powtarzaÄ‡ 2 razy tego samego), ktÃ³re po poÅ‚Ä…czeniu go z _Related Company_ udostÄ™pnia potrzebne informacje.

JeÅ›li wiesz jak to zrobiÄ‡ lepiej, to daj znaÄ‡ ğŸ¤“

#### Notion + Make

Wracamy do moduÅ‚u **_Search Objects_** i uzupeÅ‚niamy kolejno:

1. **_Connection_** - jeÅ›li jeszcze nie poÅ‚Ä…czyÅ‚eÅ› Make z Notion, to naleÅ¼y to teraz wykonaÄ‡. Jak nie chcesz bawiÄ‡ siÄ™ w udostÄ™pnianie tylko konkretnych miejsc w Notion, wybierz **_Notion Public_**
2. **_Search Objects_** - podajesz **_Database Items_**
3. **_Database ID_** - ID strony Notion, na ktÃ³rej znajdujÄ… siÄ™ dane. MoÅ¼esz je pobraÄ‡ bezpoÅ›rednio z adresu URL: _notion.so/{id}_
4. **_Filter_** - miejsce, ktÃ³re zarzÄ…dza caÅ‚ym scenariuszem. Tutaj w ruch idÄ… wspomniane wyÅ¼ej checkboxy.
   W momencie kiedy zadanie jest zrealizowane, zaznaczam **_Run scripts_** co jest sygnaÅ‚em dla Make, Å¼e podczas wywoÅ‚ania scenariusza, do tego zadania moÅ¼e zostaÄ‡ wystawiona faktura.
   Drugim, rÃ³wnie istotnym checkbox'em jest **_Autogenerated invoice via Make_**, ktÃ³ry z kolei zapobiega dublom. Podczas startu scenariusza jest on pusty, a dopiero w momencie zakoÅ„czenia sekwencji, automatycznie zostaje odfajkowany. PoniewaÅ¼ chcÄ™, Å¼eby Make braÅ‚ pod uwagÄ™ zadania z aktywnym **_Run scripts_** i z nieaktywnym **_Autogenerated invoice via Make_**. Zatem mÃ³j warunek wyglÄ…da tak:

![Filtr w module Notion: Search Object](/assets/images/2-automatyzacja-wystawiania-i-wysylki-faktur-notion-infakt-make/make-notion-filter.png)

âŒ˜+S (Ctrl+S) i zapisujemy zmiany.

### ModuÅ‚ HTTP i wykorzystanie API

Nawet jeÅ›li aplikacja/platforma nie ma bezpoÅ›redniej integracji z Make (tak jest np. w przypadku Notion), to jeÅ›li tylko miejsce, z ktÃ³rym chcemy siÄ™ poÅ‚Ä…czyÄ‡ udostÄ™pnia interfejs API, caÅ‚y cyfrowy Å›wiat stoi przed nami otworem.

Tak jest i w tym scenariuszu, gdzie chcÄ…c poÅ‚Ä…czyÄ‡ siÄ™ z Infaktem, korzystam wÅ‚aÅ›nie z tego moduÅ‚u. Do klawiatury!

#### Wystawienie faktury

Prawy klik i odszukujemy moduÅ‚ **_HTTP_**.

> Na tym etapie musisz mieÄ‡ wygenerowany klucz API Infaktu. JeÅ›li jeszcze tego nie zrobiÅ‚eÅ›, [[Jak wygenerowaÄ‡ w Infakt klucz API|tutaj]] sprawdzisz jak to zrobisz w parÄ™ chwil.

> JeÅ›li rÃ³wnieÅ¼ tworzysz integracjÄ™ z Infakt (bo wykorzystany przykÅ‚ad pewnie zagra teÅ¼ z innymi platformami), warto mieÄ‡ otwartÄ… <a href="https://docs.infakt.pl/" target="_blank_">dokumentacjÄ™ API</a>. Nie bÄ™dÄ™ skupiaÅ‚ siÄ™ na samych requestach jakoÅ› specjalnie. PrzykÅ‚ady z dokumentacji powinny w zupeÅ‚noÅ›ci wystarczyÄ‡.

Lecimy po kolei:

1. **_Credentials_** -
2. **_URL_** -
3. **_Method_** -
4. **_Headers_** -
5. **_Query String_** -
6. **_Body Type_** -
7. **_Content Type_** -
8. **_Request Content_** -
9. **_Parse response_** -

#### WysÅ‚anie faktury

WysyÅ‚ka faktury realizowana jest bardzo podobnie, tak Å¼e kolejny moduÅ‚ to rÃ³wnieÅ¼ HTTP. Zmieniam jedynie **_endpoint_** (sprawdÅº <a href="https://docs.infakt.pl/#f410d26b-0c38-47fb-8224-7f500a5f3666" target="_blank_">dokumentacjÄ™</a>) oraz **_body_**, ktÃ³re w tym konkretnym przypadku zostawiam puste. Spowoduje to pobranie domyÅ›lnego adresu klienta ustawionego bezpoÅ›rednio w Infakcie.

Jak widzisz w dokumentacji, **_endpoint_** wymaga dynamicznego przekazania **_ID_** wystawionej przed momentem faktury. DziÄ™ki zaznaczonemu w ustawieniach poprzedniego moduÅ‚u **_Parse response_** mam teraz bezpoÅ›redni dostÄ™p do wszystkich informacji udostÄ™pnianych podczas tworzenia dokumentu. Wystarczy wklikaÄ‡ siÄ™ w odpowiednie miejsce i wybraÄ‡ z dostÄ™pnej listy danych **_ID_**. Bajka!

![Struktura moduÅ‚u HTTP](/assets/images/2-automatyzacja-wystawiania-i-wysylki-faktur-notion-infakt-make/make-http-infakt-send.png)

### Koniec sekwencji

Po wystawieniu i wysÅ‚aniu faktury, wracam do moduÅ‚u zwiÄ…zanego z Notion i przekazujÄ™ informacjÄ™ o zmianie statusu checkboxa **_Autogenerated invoice via Make_** z **_false_** na **_true_** przez co zadanie zostaje w caÅ‚oÅ›ci zamkniÄ™te i nie jest uwzglÄ™dniane podczas kolejnego wywoÅ‚ania sekwencji.
Nie korzystam tutaj z **_Search Object_** jak to byÅ‚o za pierwszym razem, a z **_Update a Database Item_**. Sam moduÅ‚ wyglÄ…da podobnie, choÄ‡ naturalnie sÄ… rÃ³Å¼nice. SprawdÅº poniÅ¼ej:

![Struktura moduÅ‚u Notion: Update Database Item](/assets/images/2-automatyzacja-wystawiania-i-wysylki-faktur-notion-infakt-make/make-notion-update-database-item.png)
